---
title: "Scheduled Test"
output: html_document
---


```{r cars}
library(dplyr)

#historical_prev <- readRDS("/data/Ambulatory/Data/historical_data.rds")

#if(max(historical_prev$Appt.DateYear) == (Sys.Date() - 1)){
#  return(NULL)
#}else{
source("process_amb_singleday.R")


#historical.data <- bind_rows(historical_prev, historical.data)
#max_date_historical <- max(historical.data$Appt.DateYear) - 1095
#historical.data <- historical.data %>% filter(Appt.DateYear >= max_date_historical)
saveRDS(historical.data, "/data/Ambulatory/Data/historical_data.rds")
#rm(historical_prev)

#pop_prev <- readRDS("/data/Ambulatory/Data/population_data.rds")
#population.data_filtered <- bind_rows(pop_prev, population.data_filtered)
#max_date_pop <- max(population.data_filtered$Appt.DateYear) - 365
#population.data_filtered <- population.data_filtered #%>% filter(Appt.DateYear >= max_date_pop)
saveRDS(population.data_filtered, "/data/Ambulatory/Data/population_data.rds")
#rm(pop_prev)

#utilization_prev <- readRDS("/data/Ambulatory/Data/utilization_data.rds")
#utilization.data <- bind_rows(utilization_prev, utilization.data)
max_date_util <- max(utilization.data$Appt.DateYear) - 60
utilization.data <- utilization.data #%>% filter(Appt.DateYear >= max_date_util)
saveRDS(utilization.data, "/data/Ambulatory/Data/utilization_data.rds")
#rm(utilization_prev)

#holid_prev <- as.data.frame(read_feather("/data/Ambulatory/Data/holid.feather"))
#holid <- bind_rows(holid_prev,holid)
write_feather(holid, "/data/Ambulatory/Data/holid.feather")
#}


```

